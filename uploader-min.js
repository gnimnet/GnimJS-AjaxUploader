/*
 *  This JavaScript file for Ajax Upload JavaScript component
 *  this component works for GnimJS
 *  Version 0.2.0
 *  Write by Ming
 *  Date 2019.10.28
 */
(function(h,v,C){var f=0;var A=0;var b=false;var d="uploader-input-";var w="uploader-iframe-";var k="javascript:;";var q="uploader-con";var a="uploader-form";var p="uploader-input-con";var g="uploader-input";var m="uploader-iframe-con";var s="uploader-iframe";var z="param";var l="action";var j="onSubmit";var t="onProgress";var B="onComplete";function c(D){return D===C||D===v}function n(){}var e={param:v,action:v,onSubmit:v,onProgress:v,onComplete:v,uploading:false,_files:v,_iframe:v,_$dom:v};i.prototype={setConfig:r,addFile:u,removeFile:y,removeAllFile:x,submit:o};function i(D,G){var H=this;for(var F in e){H[F]=e[F]}var E=h(D);if(E.length!=1){throw new Error("selector should find only one element")}E.addClass(q);h('<form encType="multipart/form-data" method="post" class="'+a+'"><div class="'+p+'"></div><div class="'+m+'"></div></form>').appendTo(E);H._$dom=E;H._files={};H[z]={};if(!c(G)){H.setConfig(G)}}function r(D){var E=this;if(!c(D)){if(!c(D[z])){E[z]=D[z]}if(!c(D[l])){E[l]=D[l]}if(!c(D[j])){E[j]=D[j]}if(!c(D[t])){E[t]=D[t]}if(!c(D[B])){E[B]=D[B]}}}function u(F,D){var G=this;G.removeFile(F);var E=d+(f++);G._files[F]=E;h('<input name="'+F+'" class="'+g+" "+E+'" type="file"'+(D?" multiple":"")+" />").appendTo(G._$dom.find("."+p))}function y(D){var E=this;if(!c(E._files[D])){E._$dom.find("."+E._files[D]).remove();delete E._files[D]}}function x(){var D=this;for(var E in D._files){D.removeFile(E)}}function o(I){var H=this;I=I||{};if(H[z]){h.inject(I,H[z])}if(H[j]){var L=H[j](I);if(L){return}}var J=H[l];var E=J.indexOf("?")>0;for(var F in I){var M=encodeURIComponent(I[F]);if(E){J+="&"+F+"="+M}else{J+="?"+F+"="+M;E=true}}if(!b&&window.XMLHttpRequest&&window.FormData){var N=new XMLHttpRequest();var G=new FormData();H._$dom.find("."+a+" input").each(function(O){if(O.name&&O.files){for(var P=0;P<O.files.length;P++){G.append(O.name,O.files[P])}}});N.upload.addEventListener("progress",function(O){if(O&&O.lengthComputable&&H[t]){H[t](O.loaded,O.total)}},false);N.addEventListener("load",function(O){if(O&&O.target&&H[B]){H[B](O.target.responseText)}H.uploading=false},false);N.addEventListener("error",function(O){H.uploading=false},false);N.addEventListener("abort",function(O){H.uploading=false},false);N.open("POST",J);N.send(G)}else{var K=H._iframe=w+(A++);h('<iframe id="'+K+'" name="'+K+'" class="'+s+'" src="'+k+'" style="display:none;"></iframe>').load(function(){if(H.uploading){var O=H._$dom.find("."+s)[0];var P=O.contentDocument?O.contentDocument:document.frames[K].document;if(H[B]){H[B](h(P.body).text())}H.uploading=false}}).appendTo(H._$dom.find("."+m).empty());var D=H._$dom.find("."+a)[0];D.target=K;D.action=J;D.submit()}H.uploading=true}window.AjaxUploader=i})(Gnim);
