/*
 *  This JavaScript file for Ajax Upload JavaScript component
 *  this component works for GnimJS
 *  Version 0.1.3
 *  Write by Ming
 *  Date 2015.07.05
 */
(function(f,e,q){function d(a){return a===q||a===e}function h(a,b){for(var c in k)this[c]=k[c];c=f(a);if(1!=c.length)throw Error("selector should find only one element");c.addClass(r);f('<form encType="multipart/form-data" method="post" class="'+m+'"><div class="'+n+'"></div><div class="'+p+'"></div></form>').appendTo(c);this._$dom=c;this._files={};this[g]={};d(b)||this.setConfig(b)}var s=0,t=0,r="uploader-con",m="uploader-form",n="uploader-input-con",p="uploader-iframe-con",g="param",k={param:e,action:e,onSubmit:e,onComplete:e,uploading:!1,_files:e,_iframe:e,_$dom:e};h.prototype={setConfig:function(a){d(a)||(d(a[g])||(this[g]=a[g]),d(a.action)||(this.action=a.action),d(a.onSubmit)||(this.onSubmit=a.onSubmit),d(a.onComplete)||(this.onComplete=a.onComplete))},addFile:function(a,b){this.removeFile(a);var c="uploader-input-"+s++;this._files[a]=c;f('<input name="'+a+'" class="uploader-input '+c+'" type="file"'+(b?" multiple":"")+" />").appendTo(this._$dom.find("."+n))},removeFile:function(a){d(this._files[a])||(this._$dom.find("."+this._files[a]).remove(),delete this._files[a])},removeAllFile:function(){for(var a in this._files)this.removeFile(a)},submit:function(a){var b=this;a=a||{};b[g]&&f.inject(a,b[g]);if(!b.onSubmit||!b.onSubmit(a)){var c=b._iframe="uploader-iframe-"+t++;f('<iframe id="'+c+'" name="'+c+'" class="uploader-iframe" src="javascript:;" style="display:none;"></iframe>').load(function(){if(b.uploading){var a=b._$dom.find(".uploader-iframe")[0],a=a.contentDocument?a.contentDocument:document.frames[c].document;if(b.onComplete)b.onComplete(f(a.body).text());b.uploading=!1}}).appendTo(b._$dom.find("."+p).empty());var e=b._$dom.find("."+m)[0];e.target=c;var d=b.action,h=0<d.indexOf("?"),l;for(l in a){var k=encodeURIComponent(a[l]);h?d+="&"+l+"="+k:(d+="?"+l+"="+k,h=!0)}e.action=d;e.submit();b.uploading=!0}}};window.AjaxUploader=h})(Gnim);
